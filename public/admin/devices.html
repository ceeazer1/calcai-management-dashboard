<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Devices - CalcAI</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <div class="container section">
    <h2>Connected Devices</h2>
    <div style="margin-bottom: 1rem; display: flex; gap: 8px; flex-wrap: wrap;">
      <button class="btn btn-success" onclick="refreshDevices()">Refresh Devices</button>
      <button class="btn btn-danger" onclick="cancelAllUpdates()">Cancel All Updates</button>
      <button class="btn btn-danger" onclick="clearAllDevices()">Clear All Devices</button>
    </div>
    <div id="deviceList" class="device-grid"></div>
  </div>

  <div id="deviceLogsPanel" class="section hidden">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px;">
      <h3 id="deviceLogsTitle" style="margin:0; font-size:1rem;">Device Logs</h3>
      <button class="btn btn-danger" onclick="closeDeviceLogs()">Close</button>
    </div>
    <pre id="deviceLogsPre" style="max-height:420px; overflow:auto; background:#0b0f1a; padding:12px; border-radius:8px; border:1px solid var(--border-color)"></pre>
  </div>

  <script src="/dashboard.js"></script>
  <script>
    function openDeviceLogs(mac){
      const pre = document.getElementById('deviceLogsPre');
      const title = document.getElementById('deviceLogsTitle');
      title.textContent = `Logs for ${mac}`;
      // Just re-render devices; logs are embedded per device
      viewLogs(mac).then(()=>{
        const device = Object.values(window.devices||{}).find(d => (d.mac||'').toLowerCase()===mac.toLowerCase());
        pre.textContent = device && device.logs ? device.logs.join('\n') : 'No logs yet';
        document.getElementById('deviceLogsPanel').classList.remove('hidden');
        pre.scrollTop = pre.scrollHeight;
      });
    }
    function closeDeviceLogs(){
      document.getElementById('deviceLogsPanel').classList.add('hidden');
    }
  </script>
</body>
</html>

